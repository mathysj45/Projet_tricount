{% extends "layout.html.twig" %}

{% block header %}
    {% include "partials/_header-user.html.twig" %}
{% endblock %}

{% block main %}
<main class="py-5 container">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Tableau de bord</h1>
        <div>
            <a href="index.php?route=add_expense" class="btn btn-success me-2">
                <i class="bi bi-plus-circle"></i> Ajouter une d√©pense
            </a>
            <a href="index.php?route=add_reimbursement" class="btn btn-warning text-dark">
                <i class="bi bi-cash-coin"></i> Rembourser (Libre)
            </a>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <h3 class="card-title mb-3">Derni√®res d√©penses (Non sold√©es)</h3>
            
            {% if expenses is empty %}
                <div class="alert alert-info text-center">
                    Aucune d√©pense en cours pour le moment. Tout est r√©gl√© ! üéâ
                </div>
            {% else %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th>Date</th>
                                <th>Titre</th>
                                <th>Cat√©gorie</th>
                                <th>Pay√© par</th>
                                <th class="text-end">Montant</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for expense in expenses %}
                                <tr>
                                    <td>{{ expense.getDate()|date("d/m/Y") }}</td>
                                    
                                    <td>{{ expense.getTitle() }}</td>
                                    
                                    <td>
                                        <span class="badge bg-secondary">{{ expense.categoryLabel }}</span>
                                    </td>
                                    
                                    <td>
                                        <strong>{{ expense.payerName }}</strong>
                                    </td>
                                    
                                    <td class="text-end fw-bold">{{ expense.getAmount() }} ‚Ç¨</td>
                                    
                                    <td class="text-center">
                                        {% if expense.getUserId() != session.user.getId() %}
                                            <a href="index.php?route=add_reimbursement&expense_id={{ expense.getId() }}" 
                                               class="btn btn-sm btn-outline-primary"
                                               title="Rembourser cette d√©pense sp√©cifique">
                                               Rembourser
                                            </a>
                                        {% else %}
                                            <span class="text-muted small">C'est vous</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>
</main>
{% endblock %}